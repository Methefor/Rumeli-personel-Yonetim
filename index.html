<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rumeli ƒ∞skelesi Personel Y√∂netimi</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23e94560;stop-opacity:1'/%3E%3Cstop offset='100%25' style='stop-color:%23ff6b6b;stop-opacity:1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='12' fill='url(%23grad)'/%3E%3Cpath d='M20 16 h24 a4 4 0 0 1 4 4 v28 a4 4 0 0 1 -4 4 h-24 a4 4 0 0 1 -4 -4 v-28 a4 4 0 0 1 4 -4 z' fill='%23fff' opacity='0.95'/%3E%3Cpath d='M28 12 h8 a2 2 0 0 1 2 2 v2 a2 2 0 0 1 -2 2 h-8 a2 2 0 0 1 -2 -2 v-2 a2 2 0 0 1 2 -2 z' fill='%23e94560'/%3E%3Cline x1='24' y1='26' x2='40' y2='26' stroke='%2316213e' stroke-width='2' stroke-linecap='round'/%3E%3Cline x1='24' y1='34' x2='36' y2='34' stroke='%2316213e' stroke-width='2' stroke-linecap='round'/%3E%3Cline x1='24' y1='42' x2='40' y2='42' stroke='%2316213e' stroke-width='2' stroke-linecap='round'/%3E%3Ccircle cx='24' cy='26' r='2' fill='%2351cf66'/%3E%3Ccircle cx='24' cy='34' r='2' fill='%23ffd43b'/%3E%3Ccircle cx='24' cy='42' r='2' fill='%23339af0'/%3E%3C/svg%3E">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: #eaeaea;
            --text-secondary: #a0a0a0;
            --accent: #e94560;
            --border: #2a2a4a;
            --izgara: #ff6b6b;
            --mutfak: #51cf66;
            --ocak: #ff922b;
            --kasiyer: #339af0;
            --garson: #ffd43b;
            --temizlik: #9775fa;
            --success: #51cf66;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header h1 {
            font-size: 1.3rem;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header h1::before {
            content: "üçΩÔ∏è";
        }

        .nav-menu {
            padding: 16px 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--accent);
            color: white;
        }

        .nav-item i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 101;
            background: var(--accent);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            font-size: 1.3rem;
            cursor: pointer;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 24px;
            min-height: 100vh;
        }

        .page-header {
            margin-bottom: 24px;
        }

        .page-header h2 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .page-header p {
            color: var(--text-secondary);
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
        }

        .stat-icon.blue { background: rgba(51, 154, 240, 0.15); }
        .stat-icon.green { background: rgba(81, 207, 102, 0.15); }
        .stat-icon.orange { background: rgba(255, 146, 43, 0.15); }
        .stat-icon.purple { background: rgba(151, 117, 250, 0.15); }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 4px;
        }

        .stat-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: #d63d54;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: #1a4d7f;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #3fb950;
        }

        /* Staff Grid */
        .staff-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
        }

        .staff-card {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
            position: relative;
        }

        .staff-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .staff-card.manager {
            border: 2px solid #ffd700;
        }

        .staff-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .staff-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .role-badge {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 6px;
            background: var(--accent);
            color: white;
        }

        .part-time-badge {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 6px;
            background: var(--ocak);
            color: white;
        }

        .positions {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .position-tag {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .position-tag.izgara { background: var(--izgara); color: white; }
        .position-tag.mutfak { background: var(--mutfak); color: white; }
        .position-tag.ocak { background: var(--ocak); color: white; }
        .position-tag.kasiyer { background: var(--kasiyer); color: white; }
        .position-tag.garson { background: var(--garson); color: #1a1a2e; }
        .position-tag.temizlik { background: var(--temizlik); color: white; }

        .staff-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .icon-btn.edit {
            background: var(--kasiyer);
            color: white;
        }

        .icon-btn.delete {
            background: var(--accent);
            color: white;
        }

        /* Schedule Table */
        .schedule-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .schedule-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .schedule-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--bg-tertiary);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .schedule-table th {
            background: var(--bg-secondary);
            padding: 16px 12px;
            text-align: center;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .schedule-table th.today {
            background: rgba(81, 207, 102, 0.2);
            border-left: 3px solid var(--success);
            border-right: 3px solid var(--success);
        }

        .schedule-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            border-right: 1px solid var(--border);
            vertical-align: top;
            min-height: 100px;
        }

        .schedule-table td:last-child {
            border-right: none;
        }

        .shift-label {
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
            text-align: center;
        }

        .shift-cell {
            min-height: 120px;
            background: var(--bg-secondary);
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .shift-cell.empty {
            border: 2px dashed #475569;
        }

        .shift-cell.empty:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
        }

        .shift-cell.empty::before {
            content: "‚ûï Personel Ekle";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #94a3b8;
            font-style: italic;
            font-size: 0.85rem;
            opacity: 0.6;
        }

        .shift-cell.drag-over {
            background: rgba(233, 69, 96, 0.1);
            border: 2px solid var(--accent);
        }

        .shift-count {
            position: absolute;
            top: 6px;
            right: 6px;
            background: rgba(148, 163, 184, 0.3);
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .shift-assignments {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding-top: 20px;
        }

        .assigned-staff {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            transition: all 0.2s ease;
        }

        .assigned-staff:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .assigned-staff.dragging {
            opacity: 0.5;
        }

        .remove-btn {
            background: rgba(0, 0, 0, 0.3);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: rgba(0, 0, 0, 0.6);
            transform: scale(1.1);
        }

        /* Staff Pool */
        .staff-pool-container {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
        }

        .pool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .pool-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .filter-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .filter-btn {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background: var(--bg-tertiary);
        }

        .filter-btn.active {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        .staff-pool {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .pool-item {
            background: var(--bg-secondary);
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            cursor: move;
            transition: all 0.2s ease;
        }

        .pool-item:hover {
            background: var(--bg-tertiary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .pool-item.dragging {
            opacity: 0.5;
        }

        .pool-item > div:first-child {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .pool-item .positions {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: var(--bg-primary);
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .search-box {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Alert */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .alert.show {
            opacity: 1;
            transform: translateY(0);
        }

        .alert.error {
            background: var(--accent);
            color: white;
        }

        .alert.success {
            background: var(--mutfak);
            color: white;
        }

        /* Dashboard enhancements */
        .chart-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            gap: 12px;
            margin-top: 20px;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .bar {
            width: 100%;
            background: var(--bg-tertiary);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.3s ease;
            min-height: 20px;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar.today {
            background: var(--success);
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .bar-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .top-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }

        .top-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .top-item:hover {
            background: var(--bg-primary);
            transform: translateX(4px);
        }

        .top-rank {
            font-size: 1.5rem;
        }

        .top-info {
            flex: 1;
        }

        .top-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .top-shifts {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .empty-list {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .idle-staff-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .idle-staff-item {
            padding: 10px 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .idle-name {
            font-weight: 500;
        }

        .idle-positions {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .weekly-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .summary-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-icon {
            font-size: 1.5rem;
        }

        .summary-info {
            flex: 1;
        }

        .summary-value {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Toast notification for WhatsApp export */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 24px;
            background: var(--success);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .mobile-menu-btn {
                display: flex;
            }

            .main-content {
                margin-left: 0;
                padding: 70px 16px 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .staff-grid {
                grid-template-columns: 1fr;
            }

            .schedule-table {
                font-size: 0.85rem;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 8px 6px;
            }

            .staff-pool {
                grid-template-columns: 1fr;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .schedule-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .schedule-actions {
                flex-direction: column;
            }

            .weekly-summary {
                grid-template-columns: 1fr;
            }

            .bar-chart {
                height: 150px;
                gap: 6px;
            }
        }

        



        /* √ñzel G√ºnler */
        .special-day-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            margin-left: 8px;
        }
        
        .special-day-badge.bayram { background: #dc2626; color: white; }
        .special-day-badge.festival { background: #a855f7; color: white; }
        .special-day-badge.etkinlik { background: #3b82f6; color: white; }
        .special-day-badge.ozel { background: #ec4899; color: white; }

        /* Leave/Off Day Styles */
        .leave-section {
            margin-top: 12px;
            padding: 12px;
            background: rgba(255, 146, 43, 0.1);
            border-radius: 8px;
            border: 1px dashed var(--ocak);
        }

        .leave-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--ocak);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .leave-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .leave-item {
            padding: 4px 10px;
            background: var(--ocak);
            color: white;
            border-radius: 6px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }


        /* Yeni Tablo Stili */
        .schedule-table {
            table-layout: fixed;
        }

        .position-label {
            font-weight: 600;
            background: var(--bg-secondary);
            padding: 12px;
            text-align: left;
            border-right: 2px solid var(--border);
            white-space: nowrap;
        }

        .schedule-cell {
            padding: 8px;
            min-height: 50px;
            vertical-align: top;
            position: relative;
        }

        .staff-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .staff-tag {
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            transition: all 0.2s;
        }

        .staff-tag:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .empty-cell {
            color: var(--text-secondary);
            font-size: 1.2rem;
            text-align: center;
            padding: 20px 0;
            opacity: 0.3;
        }

        .schedule-cell.drag-over {
            background: rgba(51, 154, 240, 0.1);
            border: 2px dashed var(--accent);
        }

        /* Gamification Styles */
        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }

        .badge-item {
            background: var(--bg-tertiary);
            padding: 16px;
            border-radius: 12px;
            border: 2px solid var(--border);
            text-align: center;
            transition: all 0.2s ease;
        }

        .badge-item.earned {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .badge-item.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .badge-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }

        .badge-name {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .badge-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .leaderboard-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .leaderboard-tab {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .leaderboard-tab.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .leaderboard-item:hover {
            transform: translateX(4px);
            border-color: var(--accent);
        }

        .leaderboard-item.gold {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .leaderboard-item.silver {
            border-color: #c0c0c0;
            background: rgba(192, 192, 192, 0.1);
        }

        .leaderboard-item.bronze {
            border-color: #cd7f32;
            background: rgba(205, 127, 50, 0.1);
        }

        .leaderboard-rank {
            font-size: 1.8rem;
            font-weight: 700;
            min-width: 50px;
            text-align: center;
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .leaderboard-stats {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .leaderboard-badges {
            display: flex;
            gap: 4px;
            font-size: 1.2rem;
        }

        /* Performance Styles */
        .stars {
            display: flex;
            gap: 4px;
            font-size: 1.5rem;
        }

        .star {
            cursor: pointer;
            color: #444;
            transition: all 0.2s ease;
        }

        .star.filled {
            color: #ffd700;
        }

        .star:hover {
            transform: scale(1.2);
        }

        .review-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .review-item {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .review-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .review-criteria {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .criteria-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }
    </style>
</head>
<body>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
    
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>Rumeli ƒ∞skelesi</h1>
            </div>
            <nav class="nav-menu">
                <div class="nav-item active" onclick="showPage('dashboard')">
                    <i>üìä</i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showPage('staff')">
                    <i>üë•</i>
                    <span>Personel Listesi</span>
                </div>
                <div class="nav-item" onclick="showPage('schedule')">
                    <i>üìÖ</i>
                    <span>Vardiya Planƒ±</span>
                </div>
                <div class="nav-item" onclick="showPage('performance')">
                    <i>‚≠ê</i>
                    <span>Performans</span>
                </div>
                <div class="nav-item" onclick="showPage('gamification')">
                    <i>üèÜ</i>
                    <span>Liderlik & Rozetler</span>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <div class="page-header">
                    <h2>Dashboard</h2>
                    <p>Restoran personel y√∂netimine ho≈ü geldiniz</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">üë•</div>
                        <div class="stat-info">
                            <h3 id="total-staff">15</h3>
                            <p>Toplam Personel</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">‚úÖ</div>
                        <div class="stat-info">
                            <h3 id="assigned-shifts">0</h3>
                            <p>Atanan Vardiya</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">üì¶</div>
                        <div class="stat-info">
                            <h3 id="total-positions">6</h3>
                            <p>Pozisyon</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">üëî</div>
                        <div class="stat-info">
                            <h3 id="weekly-coverage">0%</h3>
                            <p>Haftalƒ±k Kapsama</p>
                        </div>
                    </div>
                </div>

                <!-- Bar Chart -->
                <div class="chart-card">
                    <div class="card-title">üìä Son 7 G√ºn Vardiya Daƒüƒ±lƒ±mƒ±</div>
                    <div class="bar-chart" id="bar-chart">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Top 3 Workers -->
                    <div class="chart-card">
                        <div class="card-title">üèÜ Bu Hafta En √áok √áalƒ±≈üanlar</div>
                        <div class="top-list" id="top-workers">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <!-- Idle Staff -->
                    <div class="chart-card">
                        <div class="card-title">üò¥ Bu Hafta Bo≈ü Personeller</div>
                        <div class="idle-staff-list" id="idle-staff">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <!-- Weekly Summary -->
                    <div class="chart-card">
                        <div class="card-title">üìà Haftalƒ±k √ñzet</div>
                        <div class="weekly-summary" id="weekly-summary">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Pozisyon Daƒüƒ±lƒ±mƒ±</div>
                    <div id="position-summary" style="margin-top: 12px;">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Staff Page -->
            <div id="staff-page" class="page">
                <div class="page-header">
                    <h2>Personel Listesi</h2>
                    <p>Restoran personelinizi y√∂netin</p>
                </div>

                <input type="text" class="search-box" id="staff-search" placeholder="üîç Personel ara..." oninput="filterStaff()">

                <button class="btn btn-primary" onclick="openStaffModal()" style="margin-bottom: 20px;">
                    ‚ûï Yeni Personel Ekle
                </button>

                <div class="staff-grid" id="staff-list">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Schedule Page -->
            <div id="schedule-page" class="page">
                <div class="page-header">
                    <h2>Haftalƒ±k Vardiya Planƒ±</h2>
                    <p>Personel vardiya atamalarƒ±nƒ± d√ºzenleyin</p>
                </div>

                <div class="schedule-controls">
                        >
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-weight: 600;">Bu Hafta</span>
                        <span style="color: var(--text-secondary); font-size: 0.9rem;" id="week-range"></span>
                    </div>
                    <div class="schedule-actions">
                        <button class="btn btn-success" onclick="exportToWhatsApp()">üì± WhatsApp'a G√∂nder</button>
                        <button class="btn btn-secondary" onclick="copyWeek()">üîÑ Bu Haftayƒ± Kopyala</button>
                        <button class="btn btn-secondary" onclick="clearWeek()">üóëÔ∏è Bu Haftayƒ± Temizle</button>
                    </div>
                </div>

                <div class="card">
                    <div style="color: var(--text-secondary); margin-bottom: 16px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: var(--izgara); border-radius: 4px;"></div>
                            <span>üî• Izgara</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: var(--mutfak); border-radius: 4px;"></div>
                            <span>üë®‚Äçüç≥ Mutfak</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: var(--ocak); border-radius: 4px;"></div>
                            <span>üç≥ Ocak</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: var(--kasiyer); border-radius: 4px;"></div>
                            <span>üí∞ Kasiyer</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: var(--garson); border-radius: 4px;"></div>
                            <span>üçΩÔ∏è Garson</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: var(--temizlik); border-radius: 4px;"></div>
                            <span>üßπ Temizlik</span>
                        </div>
                    </div>
                    
                    <table class="schedule-table">
                    <thead>
                        <tr>
                            <th style="width: 150px;">POZƒ∞SYON</th>
                            <th>Pazartesi</th>
                            <th>Salƒ±</th>
                            <th>√áar≈üamba</th>
                            <th>Per≈üembe</th>
                            <th>Cuma</th>
                            <th>Cumartesi</th>
                            <th>Pazar</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body"></tbody>
                </table>
                </div>


                <div class="card">
                    <div class="card-title">üìÖ ƒ∞zinli Personel Y√∂netimi</div>
                    <div style="margin-bottom: 16px;">
                        <button class="btn btn-secondary" onclick="openLeaveModal()">‚ûï ƒ∞zin Ekle</button>
                    </div>
                    <div id="leave-summary"></div>
                </div>

                <div class="staff-pool-container">
                    <div class="pool-header">
                        <div class="pool-title">M√ºsait Personel (S√ºr√ºkle-Bƒ±rak)</div>
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterPool('all')">T√ºm√º</button>
                        <button class="filter-btn" onclick="filterPool('Izgara')">üî• Izgara</button>
                        <button class="filter-btn" onclick="filterPool('Mutfak')">üë®‚Äçüç≥ Mutfak</button>
                        <button class="filter-btn" onclick="filterPool('Ocak')">üç≥ Ocak</button>
                        <button class="filter-btn" onclick="filterPool('Kasiyer')">üí∞ Kasiyer</button>
                        <button class="filter-btn" onclick="filterPool('Garson')">üçΩÔ∏è Garson</button>
                        <button class="filter-btn" onclick="filterPool('Temizlik')">üßπ Temizlik</button>
                    </div>
                    <div class="staff-pool" id="staff-pool">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Performance Page -->
            <div id="performance-page" class="page">
                <div class="page-header">
                    <h2>‚≠ê Performans Deƒüerlendirme</h2>
                    <p>Personel performansƒ±nƒ± deƒüerlendirin ve takip edin</p>
                </div>

                <button class="btn btn-primary" onclick="openPerformanceModal()" style="margin-bottom: 20px;">
                    ‚ûï Yeni Deƒüerlendirme Ekle
                </button>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="card">
                        <div class="card-title">üìä Ortalama Performans</div>
                        <div id="avg-performance-summary"></div>
                    </div>

                    <div class="card">
                        <div class="card-title">‚≠ê En Y√ºksek Performans</div>
                        <div id="top-performance"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üìã Son Deƒüerlendirmeler</div>
                    <div class="review-list" id="review-list"></div>
                </div>
            </div>


            <!-- Gamification Page -->
            <div id="gamification-page" class="page">
                <div class="page-header">
                    <h2>üèÜ Liderlik & Rozetler</h2>
                    <p>Ba≈üarƒ±larƒ± ve liderlik sƒ±ralamasƒ±nƒ± g√∂r√ºnt√ºleyin</p>
                </div>

                <div class="card">
                    <div class="card-title">üèÜ Liderlik Panosu</div>
                    <div class="leaderboard-tabs">
                        <div class="leaderboard-tab active" onclick="showLeaderboard('weekly')">Bu Hafta</div>
                        <div class="leaderboard-tab" onclick="showLeaderboard('alltime')">T√ºm Zamanlar</div>
                        <div class="leaderboard-tab" onclick="showLeaderboard('performance')">Performans</div>
                    </div>
                    <div class="leaderboard-list" id="leaderboard-list"></div>
                </div>

                <div class="card">
                    <div class="card-title">üéñÔ∏è Rozetler</div>
                    <div class="badge-grid" id="all-badges"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- Staff Modal -->
    <div class="modal-overlay" id="staff-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modal-title">Yeni Personel Ekle</div>
                <button class="close-btn" onclick="closeStaffModal()">√ó</button>
            </div>
            <form onsubmit="saveStaff(event)">
                <div class="form-group">
                    <label>ƒ∞sim</label>
                    <input type="text" id="staff-name" required>
                </div>
                <div class="form-group">
                    <label>Pozisyonlar</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="position" value="Izgara"> üî• Izgara
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="position" value="Mutfak"> üë®‚Äçüç≥ Mutfak
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="position" value="Ocak"> üç≥ Ocak
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="position" value="Kasiyer"> üí∞ Kasiyer
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="position" value="Garson"> üçΩÔ∏è Garson
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="position" value="Temizlik"> üßπ Temizlik
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>√ñzel Rol (Opsiyonel)</label>
                    <select id="staff-role">
                        <option value="">Yok</option>
                        <option value="Mesul M√ºd√ºr">üëë Mesul M√ºd√ºr</option>
                        <option value="Part-time">‚è∞ Part-time</option>
                    </select>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Kaydet</button>
                    <button type="button" class="btn btn-secondary" onclick="closeStaffModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Performance Modal -->
    <div class="modal-overlay" id="performance-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Performans Deƒüerlendirmesi</div>
                <button class="close-btn" onclick="closePerformanceModal()">√ó</button>
            </div>
            <form onsubmit="savePerformance(event)">
                <div class="form-group">
                    <label>Personel Se√ß</label>
                    <select id="perf-staff" required onchange="updatePerformancePositions()"></select>
                </div>
                <div class="form-group">
                    <label>Pozisyon</label>
                    <select id="perf-position" required></select>
                </div>
                <div class="form-group">
                    <label>Hƒ±z & Verimlilik</label>
                    <div class="stars" data-criteria="speed">
                        <span class="star" onclick="setRating(event, 1)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 2)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 3)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 4)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 5)">‚òÖ</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Hijyen & Temizlik</label>
                    <div class="stars" data-criteria="hygiene">
                        <span class="star" onclick="setRating(event, 1)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 2)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 3)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 4)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 5)">‚òÖ</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>√úr√ºn Kalitesi</label>
                    <div class="stars" data-criteria="quality">
                        <span class="star" onclick="setRating(event, 1)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 2)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 3)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 4)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 5)">‚òÖ</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Takƒ±m √áalƒ±≈ümasƒ±</label>
                    <div class="stars" data-criteria="teamwork">
                        <span class="star" onclick="setRating(event, 1)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 2)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 3)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 4)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 5)">‚òÖ</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Stres Y√∂netimi</label>
                    <div class="stars" data-criteria="stress">
                        <span class="star" onclick="setRating(event, 1)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 2)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 3)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 4)">‚òÖ</span>
                        <span class="star" onclick="setRating(event, 5)">‚òÖ</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notlar (Opsiyonel)</label>
                    <textarea id="perf-notes" placeholder="Deƒüerlendirme notlarƒ±..."></textarea>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Kaydet</button>
                    <button type="button" class="btn btn-secondary" onclick="closePerformanceModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>



    <!-- Special Day Modal -->
    <div class="modal-overlay" id="special-day-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">üéâ √ñzel G√ºn Ekle</div>
                <button class="close-btn" onclick="closeSpecialDayModal()">√ó</button>
            </div>
            <form onsubmit="saveSpecialDay(event)">
                <div class="form-group">
                    <label>G√ºn</label>
                    <select id="special-day-select" required>
                        <option value="Pazartesi">Pazartesi</option>
                        <option value="Salƒ±">Salƒ±</option>
                        <option value="√áar≈üamba">√áar≈üamba</option>
                        <option value="Per≈üembe">Per≈üembe</option>
                        <option value="Cuma">Cuma</option>
                        <option value="Cumartesi">Cumartesi</option>
                        <option value="Pazar">Pazar</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>√ñzel G√ºn Tipi</label>
                    <select id="special-day-type" required>
                        <option value="bayram">üéä Bayram</option>
                        <option value="festival">üé≠ Festival</option>
                        <option value="etkinlik">üé™ Etkinlik/Organizasyon</option>
                        <option value="ozel">üíï √ñzel G√ºn</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>A√ßƒ±klama</label>
                    <input type="text" id="special-day-name" placeholder="√∂rn: Ramazan Bayramƒ±" required>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Kaydet</button>
                    <button type="button" class="btn btn-secondary" onclick="closeSpecialDayModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Leave Modal -->
    <div class="modal-overlay" id="leave-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">ƒ∞zin Ekle</div>
                <button class="close-btn" onclick="closeLeaveModal()">√ó</button>
            </div>
            <form onsubmit="saveLeave(event)">
                <div class="form-group">
                    <label>Personel</label>
                    <select id="leave-staff" required></select>
                </div>
                <div class="form-group">
                    <label>G√ºn</label>
                    <select id="leave-day" required>
                        <option value="Pazartesi">Pazartesi</option>
                        <option value="Salƒ±">Salƒ±</option>
                        <option value="√áar≈üamba">√áar≈üamba</option>
                        <option value="Per≈üembe">Per≈üembe</option>
                        <option value="Cuma">Cuma</option>
                        <option value="Cumartesi">Cumartesi</option>
                        <option value="Pazar">Pazar</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ƒ∞zin Tipi</label>
                    <select id="leave-type">
                        <option value="Yƒ±llƒ±k ƒ∞zin">Yƒ±llƒ±k ƒ∞zin</option>
                        <option value="Hastalƒ±k">Hastalƒ±k</option>
                        <option value="Mazeret">Mazeret</option>
                        <option value="√úcretsiz ƒ∞zin">√úcretsiz ƒ∞zin</option>
                    </select>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Kaydet</button>
                    <button type="button" class="btn btn-secondary" onclick="closeLeaveModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alert -->
    <div class="alert" id="alert">
        <span id="alert-icon">‚ö†Ô∏è</span>
        <span id="alert-message"></span>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span>‚úÖ</span>
        <span id="toast-message"></span>
    </div>

    <script>
        // Initial Data
        let staff = [
            { id: 1, name: "Metehan Arslan", positions: [], role: "Mesul M√ºd√ºr", totalHours: 0, badges: [] },
            { id: 2, name: "Halime G√∂ks√º", positions: ["Izgara", "Mutfak", "Ocak"], role: "", totalHours: 0, badges: [] },
            { id: 3, name: "Gizem Erdoƒüdu", positions: ["Mutfak", "Ocak", "Kasiyer"], role: "", totalHours: 0, badges: [] },
            { id: 4, name: "Batuhan Buyral", positions: ["Mutfak", "Ocak", "Kasiyer", "Garson"], role: "", totalHours: 0, badges: [] },
            { id: 5, name: "Halil ƒ∞brahim Uzun", positions: ["Izgara", "Mutfak", "Ocak", "Garson"], role: "", totalHours: 0, badges: [] },
            { id: 6, name: "Hava Aky√ºz", positions: ["Izgara", "Mutfak", "Ocak"], role: "", totalHours: 0, badges: [] },
            { id: 7, name: "Mine Pehlivanoƒülu", positions: ["Mutfak"], role: "", totalHours: 0, badges: [] },
            { id: 8, name: "Melda Yƒ±lmaz", positions: ["Kasiyer", "Garson"], role: "", totalHours: 0, badges: [] },
            { id: 9, name: "Ceren Erdem", positions: ["Kasiyer", "Garson"], role: "", totalHours: 0, badges: [] },
            { id: 10, name: "Elif Yƒ±ldƒ±rƒ±m", positions: ["Kasiyer", "Garson"], role: "", totalHours: 0, badges: [] },
            { id: 11, name: "Tuba Bozaklƒ±", positions: ["Kasiyer", "Garson"], role: "", totalHours: 0, badges: [] },
            { id: 12, name: "Emircan Bi√ßer", positions: ["Garson"], role: "", totalHours: 0, badges: [] },
            { id: 13, name: "Burak Sancar", positions: ["Garson"], role: "", totalHours: 0, badges: [] },
            { id: 14, name: "Nesrin Karadeniz", positions: ["Temizlik"], role: "", totalHours: 0, badges: [] },
            { id: 15, name: "≈ûiyar Onƒüulu", positions: ["Garson"], role: "Part-time", totalHours: 0, badges: [] }
        ];

        const days = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
        const shifts = [
            { id: 'morning', name: 'Sabah', time: 'üåÖ 08:00-16:00' },
            { id: 'afternoon', name: '√ñƒüle', time: 'üåÜ 12:00-20:00' },
            { id: 'evening', name: 'Ak≈üam', time: 'üåô 16:00-24:00' }
        ];

        const positionColors = {
            'Izgara': '#ff6b6b',
            'Mutfak': '#51cf66',
            'Ocak': '#ff922b',
            'Kasiyer': '#339af0',
            'Garson': '#ffd43b',
            'Temizlik': '#9775fa'
        };

        const positionEmojis = {
            'Izgara': 'üî•',
            'Mutfak': 'üë®‚Äçüç≥',
            'Ocak': '‚òï',
            'Kasiyer': 'üí∞',
            'Garson': 'üçΩÔ∏è',
            'Temizlik': 'üßπ'
        };


        let performances = [];

        // Badge definitions
        const badgeDefinitions = [
            { id: 'novice', name: '√áaylak', emoji: 'ü•â', desc: '50 saat', threshold: 50, type: 'hours' },
            { id: 'experienced', name: 'Deneyimli', emoji: 'ü•à', desc: '150 saat', threshold: 150, type: 'hours' },
            { id: 'expert', name: 'Uzman', emoji: 'ü•á', desc: '300 saat', threshold: 300, type: 'hours' },
            { id: 'master', name: 'Master', emoji: 'üíé', desc: '500+ saat', threshold: 500, type: 'hours' },
            { id: 'izgara-master', name: 'Izgara Ustasƒ±', emoji: 'üî•', desc: '100 saat ƒ±zgara', threshold: 100, type: 'position', position: 'Izgara' },
            { id: 'quick-cashier', name: 'Hƒ±zlƒ± Kasiyer', emoji: 'üí∞', desc: '50 vardiya', threshold: 50, type: 'shifts', position: 'Kasiyer' },
            { id: 'super-waiter', name: 'S√ºper Garson', emoji: 'üçΩÔ∏è', desc: '200 saat garsonluk', threshold: 200, type: 'position', position: 'Garson' },
            { id: 'chef-candidate', name: '≈ûef Adayƒ±', emoji: 'üë®‚Äçüç≥', desc: '150 saat mutfak', threshold: 150, type: 'position', position: 'Mutfak' },
            { id: 'star-performer', name: 'M√ºkemmel Performans', emoji: '‚≠ê', desc: '5/5 ortalama', threshold: 4.8, type: 'performance' },
            { id: 'versatile', name: '√áok Y√∂nl√º', emoji: 'üîÑ', desc: '4 pozisyonda √ßalƒ±≈ütƒ±', threshold: 4, type: 'positions' }
        ];

        let currentLeaderboardType = 'weekly';
        let leaves = {};
        let specialDays = {}; // { day: { type: "bayram", name: "Ramazan Bayramƒ±" } } // { day: [{ staffId, type }] }

        let currentRatings = {};

        let schedule = {};
        let currentPoolFilter = 'all';
        let editingStaffId = null;

        // Initialize schedule
        days.forEach(day => {
            schedule[day] = {};
            shifts.forEach(shift => {
                schedule[day][shift.id] = [];
            });
        });

        // Load from localStorage
        function loadFromStorage() {
            const savedStaff = localStorage.getItem('staff');
            const savedSchedule = localStorage.getItem('schedule');
            const savedPerformances = localStorage.getItem('performances');
            const savedLeaves = localStorage.getItem('leaves');
            
            if (savedStaff) staff = JSON.parse(savedStaff);
            if (savedSchedule) schedule = JSON.parse(savedSchedule);
            if (savedPerformances) performances = JSON.parse(savedPerformances);
            if (savedLeaves) leaves = JSON.parse(savedLeaves);
            const savedSpecialDays = localStorage.getItem('specialDays');
            if (savedSpecialDays) specialDays = JSON.parse(savedSpecialDays);
        }

        // Save to localStorage
        function saveToStorage() {
            localStorage.setItem('staff', JSON.stringify(staff));
            localStorage.setItem('schedule', JSON.stringify(schedule));
            localStorage.setItem('performances', JSON.stringify(performances));
            localStorage.setItem('leaves', JSON.stringify(leaves));
            localStorage.setItem('specialDays', JSON.stringify(specialDays));
        }

        // Initialize
        loadFromStorage();
        // Initialize schedule structure
        days.forEach(day => {
            if (!schedule[day]) schedule[day] = {};
            shifts.forEach(shift => {
                if (!schedule[day][shift.id]) schedule[day][shift.id] = [];
            });
        });

        updateDashboard();
        renderStaffList();
        renderSchedule();
        renderLeaveSummary();
        renderStaffPool();
        updateWeekRange();
        highlightToday();

        // Navigation
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(page + '-page').classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
            
            if (page === 'schedule') {
                renderSchedule();
        renderLeaveSummary();
                renderStaffPool();
            } else if (page === 'performance') {
                renderPerformancePage();
            } else if (page === 'gamification') {
                renderGamificationPage();
            }
        }

        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('show');
        }

        // Update week range
        function updateWeekRange() {
            const today = new Date();
            const monday = new Date(today);
            monday.setDate(today.getDate() - today.getDay() + 1);
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            
            const formatDate = (date) => {
                return `${date.getDate()}.${date.getMonth() + 1}.${date.getFullYear()}`;
            };
            
            document.getElementById('week-range').textContent = 
                `${formatDate(monday)} - ${formatDate(sunday)}`;
        }

        // Highlight today
        function highlightToday() {
            const today = new Date().getDay();
            const dayIndex = today === 0 ? 6 : today - 1; // Convert Sunday=0 to index 6
            const dayIds = ['day-mon', 'day-tue', 'day-wed', 'day-thu', 'day-fri', 'day-sat', 'day-sun'];
            
            if (dayIndex >= 0 && dayIndex < dayIds.length) {
                const todayHeader = document.getElementById(dayIds[dayIndex]);
                if (todayHeader) {
                    todayHeader.classList.add('today');
                    todayHeader.innerHTML += ' <span style="font-size: 0.8rem;">üìç BUG√úN</span>';
                }
            }
        }

        // Dashboard
        function updateDashboard() {
            initializeLeaves();
        updateBadges();
            document.getElementById('total-staff').textContent = staff.length;
            
            let totalShifts = 0;
            days.forEach(day => {
                shifts.forEach(shift => {
                    totalShifts += schedule[day][shift.id].length;
                });
            });
            document.getElementById('assigned-shifts').textContent = totalShifts;
            
            const totalSlots = days.length * shifts.length;
            const coverage = totalSlots > 0 ? Math.round((totalShifts / totalSlots) * 100) : 0;
            document.getElementById('weekly-coverage').textContent = coverage + '%';
            
            updateBarChart();
            updateTopWorkers();
            updateIdleStaff();
            updateWeeklySummary();
            updatePositionSummary();
        }

        function updateBarChart() {
            const chart = document.getElementById('bar-chart');
            const todayIndex = new Date().getDay() === 0 ? 6 : new Date().getDay() - 1;
            
            let html = '';
            days.forEach((day, index) => {
                let count = 0;
                shifts.forEach(shift => {
                    count += schedule[day][shift.id].length;
                });
                
                const maxCount = 20; // Max expected assignments per day
                const height = count > 0 ? (count / maxCount) * 100 : 10;
                const isToday = index === todayIndex;
                
                html += `
                    <div class="bar-item">
                        <div class="bar ${isToday ? 'today' : ''}" style="height: ${height}%;">
                            <div class="bar-value">${count}</div>
                        </div>
                        <div class="bar-label">${day.substring(0, 3)}</div>
                    </div>
                `;
            });
            
            chart.innerHTML = html;
        }

        function updateTopWorkers() {
            const container = document.getElementById('top-workers');
            const staffShifts = {};
            
            staff.forEach(s => {
                staffShifts[s.id] = 0;
            });
            
            days.forEach(day => {
                shifts.forEach(shift => {
                    schedule[day][shift.id].forEach(assignment => {
                        staffShifts[assignment.staffId]++;
                    });
                });
            });
            
            const sorted = Object.entries(staffShifts)
                .map(([id, count]) => ({
                    staff: staff.find(s => s.id === parseInt(id)),
                    count
                }))
                .filter(item => item.count > 0)
                .sort((a, b) => b.count - a.count)
                .slice(0, 3);
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="empty-list">Hen√ºz vardiya atanmamƒ±≈ü</div>';
                return;
            }
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            container.innerHTML = sorted.map((item, index) => `
                <div class="top-item" onclick="showPage('staff')">
                    <div class="top-rank">${medals[index]}</div>
                    <div class="top-info">
                        <div class="top-name">${item.staff.name}</div>
                        <div class="top-shifts">${item.count} vardiya</div>
                    </div>
                </div>
            `).join('');
        }

        function updateIdleStaff() {
            const container = document.getElementById('idle-staff');
            const assignedStaffIds = new Set();
            
            days.forEach(day => {
                shifts.forEach(shift => {
                    schedule[day][shift.id].forEach(assignment => {
                        assignedStaffIds.add(assignment.staffId);
                    });
                });
            });
            
            const idleStaff = staff.filter(s => !assignedStaffIds.has(s.id));
            
            if (idleStaff.length === 0) {
                container.innerHTML = '<div class="empty-list">‚úÖ T√ºm personel vardiyalƒ±!</div>';
                return;
            }
            
            const displayCount = 5;
            const displayed = idleStaff.slice(0, displayCount);
            const remaining = idleStaff.length - displayCount;
            
            let html = displayed.map(s => {
                const positions = s.role === "Mesul M√ºd√ºr" ? "Mesul M√ºd√ºr" : s.positions.join(', ');
                return `
                    <div class="idle-staff-item">
                        <span class="idle-name">${s.name}</span>
                        <span class="idle-positions">${positions}</span>
                    </div>
                `;
            }).join('');
            
            if (remaining > 0) {
                html += `<div class="idle-staff-item" style="color: var(--text-secondary); font-style: italic;">...ve ${remaining} ki≈üi daha</div>`;
            }
            
            container.innerHTML = html;
        }

        function updateWeeklySummary() {
            const container = document.getElementById('weekly-summary');
            
            let totalAssignments = 0;
            let emptySlots = 0;
            
            days.forEach(day => {
                shifts.forEach(shift => {
                    const count = schedule[day][shift.id].length;
                    totalAssignments += count;
                    if (count === 0) emptySlots++;
                });
            });
            
            const totalHours = totalAssignments * 8; // Each shift is 8 hours
            const avgPerShift = totalAssignments > 0 ? (totalAssignments / (days.length * shifts.length)).toFixed(1) : 0;
            
            container.innerHTML = `
                <div class="summary-item">
                    <div class="summary-icon">üìÖ</div>
                    <div class="summary-info">
                        <div class="summary-value">${totalAssignments}</div>
                        <div class="summary-label">Atanan Vardiya</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">‚è∞</div>
                    <div class="summary-info">
                        <div class="summary-value">${totalHours}</div>
                        <div class="summary-label">Toplam Saat</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">üë•</div>
                    <div class="summary-info">
                        <div class="summary-value">${avgPerShift}</div>
                        <div class="summary-label">Ort. Personel</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">‚ùå</div>
                    <div class="summary-info">
                        <div class="summary-value">${emptySlots}</div>
                        <div class="summary-label">Bo≈ü Vardiya</div>
                    </div>
                </div>
            `;
        }

        function updatePositionSummary() {
            const container = document.getElementById('position-summary');
            const positionCounts = {};
            
            days.forEach(day => {
                shifts.forEach(shift => {
                    schedule[day][shift.id].forEach(assignment => {
                        positionCounts[assignment.position] = (positionCounts[assignment.position] || 0) + 1;
                    });
                });
            });
            
            const sorted = Object.entries(positionCounts)
                .sort((a, b) => b[1] - a[1]);
            
            if (sorted.length === 0) {
                container.innerHTML = '<div style="color: var(--text-secondary); font-style: italic;">Hen√ºz vardiya atanmamƒ±≈ü</div>';
                return;
            }
            
            container.innerHTML = sorted.map(([position, count]) => `
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border);">
                    <span>${positionEmojis[position]} ${position}</span>
                    <span style="font-weight: 600;">${count} vardiya</span>
                </div>
            `).join('');
        }

        // Staff Management
        function renderStaffList() {
            const container = document.getElementById('staff-list');
            const searchTerm = document.getElementById('staff-search')?.value.toLowerCase() || '';
            
            const filtered = staff.filter(s => 
                s.name.toLowerCase().includes(searchTerm)
            );
            
            container.innerHTML = filtered.map(s => {
                const isManager = s.role === "Mesul M√ºd√ºr";
                const isPartTime = s.role === "Part-time";
                const positionTags = s.positions.map(p => 
                    `<div class="position-tag ${p.toLowerCase()}">${positionEmojis[p]} ${p}</div>`
                ).join('');
                
                const avgPerf = getAveragePerformance(s.id);
                
                return `
                    <div class="staff-card ${isManager ? 'manager' : ''}">
                        <div class="staff-header">
                            <div>
                                <div class="staff-name">
                                    ${isManager ? 'üëë ' : ''}
                                    ${s.name}
                                    ${isPartTime ? ' <span class="part-time-badge">‚è∞ Part-time</span>' : ''}
                                </div>
                                ${isManager ? '<div class="role-badge">Mesul M√ºd√ºr</div>' : ''}
                                ${avgPerf ? `<div style="color: #ffd700; font-size: 0.85rem; margin-top: 4px;">‚≠ê ${avgPerf.toFixed(1)}/5</div>` : ''}
                            </div>
                            <div class="staff-actions">
                                <button class="icon-btn edit" onclick="editStaff(${s.id})">‚úèÔ∏è</button>
                                <button class="icon-btn delete" onclick="deleteStaff(${s.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                        ${s.badges.length > 0 ? `<div style="font-size: 1.2rem; margin-bottom: 8px;">${s.badges.slice(0, 3).map(b => badgeDefinitions.find(bd => bd.id === b)?.emoji || '').join(' ')}</div>` : ''}
                        <div class="positions">
                            ${isManager ? '<div class="position-tag" style="background: #ffd700; color: #1a1a2e;">üëë T√ºm Pozisyonlar</div>' : positionTags}
                        </div>
                        <div style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                            ${s.totalHours} saat √ßalƒ±≈ütƒ±
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterStaff() {
            renderStaffList();
        }

        function openStaffModal() {
            editingStaffId = null;
            document.getElementById('modal-title').textContent = 'Yeni Personel Ekle';
            document.getElementById('staff-name').value = '';
            document.getElementById('staff-role').value = '';
            document.querySelectorAll('input[name="position"]').forEach(cb => cb.checked = false);
            document.getElementById('staff-modal').classList.add('show');
        }

        function closeStaffModal() {
            document.getElementById('staff-modal').classList.remove('show');
        }

        function editStaff(id) {
            const s = staff.find(x => x.id === id);
            if (!s) return;
            
            editingStaffId = id;
            document.getElementById('modal-title').textContent = 'Personel D√ºzenle';
            document.getElementById('staff-name').value = s.name;
            document.getElementById('staff-role').value = s.role || '';
            
            document.querySelectorAll('input[name="position"]').forEach(cb => {
                cb.checked = s.positions.includes(cb.value);
            });
            
            document.getElementById('staff-modal').classList.add('show');
        }

        function deleteStaff(id) {
            if (!confirm('Bu personeli silmek istediƒüinizden emin misiniz?')) return;
            
            staff = staff.filter(s => s.id !== id);
            
            // Remove from schedule
            days.forEach(day => {
                shifts.forEach(shift => {
                    schedule[day][shift.id] = schedule[day][shift.id].filter(a => a.staffId !== id);
                });
            });
            
            saveToStorage();
            renderStaffList();
            renderSchedule();
        renderLeaveSummary();
            updateDashboard();
            showAlert('Personel silindi', 'success');
        }

        function saveStaff(event) {
            event.preventDefault();
            
            const name = document.getElementById('staff-name').value.trim();
            const role = document.getElementById('staff-role').value;
            const positions = Array.from(document.querySelectorAll('input[name="position"]:checked'))
                .map(cb => cb.value);
            
            if (!name) {
                showAlert('L√ºtfen isim girin', 'error');
                return;
            }
            
            if (role !== "Mesul M√ºd√ºr" && positions.length === 0) {
                showAlert('L√ºtfen en az bir pozisyon se√ßin', 'error');
                return;
            }
            
            if (editingStaffId) {
                const s = staff.find(x => x.id === editingStaffId);
                s.name = name;
                s.positions = positions;
                s.role = role;
                showAlert('Personel g√ºncellendi', 'success');
            } else {
                const newId = Math.max(...staff.map(s => s.id), 0) + 1;
                staff.push({ id: newId, name, positions, role });
                showAlert('Personel eklendi', 'success');
            }
            
            saveToStorage();
            renderStaffList();
            renderStaffPool();
            closeStaffModal();
            updateDashboard();
        }

        // Schedule
        function renderSchedule() {
            const tbody = document.getElementById('schedule-body');
            if (!tbody) return;
            
            const currentShift = document.getElementById('shift-filter')?.value || 'morning';
            const shift = shifts.find(s => s.id === currentShift);
            
            if (!shift) return;
            
            // Her vardiya i√ßin pozisyonlar
            const positions = [
                { label: 'üí∞ KASA', key: 'Kasiyer', maxCount: 1 },
                { label: '‚òï OCAK', key: 'Ocak', maxCount: 1 },
                { label: 'üë®‚Äçüç≥ MUTFAK', key: 'Mutfak', maxCount: 1 },
                { label: 'üçΩÔ∏è GARSON', key: 'Garson', maxCount: 8 },
                { label: 'üßπ TEMƒ∞ZLƒ∞K', key: 'Temizlik', maxCount: 1 },
                { label: 'üí∞ R.KASA', key: 'Restoran Kasa', maxCount: 1 },
                { label: 'üî• R.IZGARA', key: 'Restoran Izgara', maxCount: 1 },
                { label: 'üçΩÔ∏è R.GARSON', key: 'Restoran Garson', maxCount: 3 }
            ];
            
            let html = '';
            
            // Her pozisyon i√ßin bir satƒ±r
            positions.forEach(pos => {
                html += `<tr>`;
                html += `<td class="position-label">${pos.label}</td>`;
                
                // Her g√ºn i√ßin bir h√ºcre
                days.forEach(day => {
                    const assignments = schedule[day]?.[shift.id] || [];
                    
                    // Bu pozisyondaki personeller
                    const staffInPosition = assignments.filter(a => {
                        if (a.positions) {
                            return a.positions.includes(pos.key);
                        }
                        return a.position === pos.key;
                    });
                    
                    const specialDay = specialDays[day];
                    const dayLeaves = leaves[day] || [];
                    
                    html += `
                        <td class="schedule-cell" 
                            ondrop="dropToPosition(event, '${day}', '${shift.id}', '${pos.key}')" 
                            ondragover="allowDrop(event)"
                            ondragleave="leaveDrop(event)">
                    `;
                    
                    // √ñzel g√ºn badge'i
                    if (specialDay) {
                        html += `<div class="special-day-badge ${specialDay.type}" style="margin-bottom: 4px;">${specialDay.name}</div>`;
                    }
                    
                    // Personelleri g√∂ster
                    if (staffInPosition.length > 0) {
                        html += '<div class="staff-list">';
                        staffInPosition.forEach((assignment, idx) => {
                            const s = staff.find(x => x.id === assignment.staffId);
                            if (!s) return;
                            
                            const hasMultiPos = assignment.positions && assignment.positions.length > 1;
                            const otherPositions = hasMultiPos ? assignment.positions.filter(p => p !== pos.key) : [];
                            
                            html += `
                                <div class="staff-tag" draggable="true" 
                                     ondragstart="dragFromPosition(event, '${day}', '${shift.id}', ${assignment.staffId}, '${pos.key}')"
                                     style="background: ${positionColors[pos.key] || '#666'}; color: white; cursor: move;">
                                    ${s.name}
                                    ${hasMultiPos ? ' +' + otherPositions.map(p => positionEmojis[p]).join('') : ''}
                                    <button class="remove-btn" onclick="removeFromPosition('${day}', '${shift.id}', ${assignment.staffId}, '${pos.key}')">√ó</button>
                                </div>
                            `;
                        });
                        html += '</div>';
                    } else {
                        html += '<div class="empty-cell">‚ûï</div>';
                    }
                    
                    html += `</td>`;
                });
                
                html += `</tr>`;
            });
            
            // ƒ∞zinli personel satƒ±rƒ±
            html += `<tr><td class="position-label">üèñÔ∏è ƒ∞Zƒ∞NLƒ∞</td>`;
            days.forEach(day => {
                const dayLeaves = leaves[day] || [];
                html += `<td class="schedule-cell" style="background: rgba(255, 146, 43, 0.05);">`;
                if (dayLeaves.length > 0) {
                    html += '<div class="staff-list">';
                    dayLeaves.forEach(leave => {
                        const s = staff.find(x => x.id === leave.staffId);
                        if (s) {
                            html += `<div class="staff-tag" style="background: var(--ocak); color: white; font-size: 0.8rem;">${s.name}</div>`;
                        }
                    });
                    html += '</div>';
                } else {
                    html += '<div class="empty-cell">-</div>';
                }
                html += `</td>`;
            });
            html += `</tr>`;
            
            tbody.innerHTML = html;
        }

        
        function renderStaffPool() {
            const pool = document.getElementById('staff-pool');
            
            let filteredStaff = staff;
            if (currentPoolFilter !== 'all') {
                filteredStaff = staff.filter(s => 
                    s.role === "Mesul M√ºd√ºr" || s.positions.includes(currentPoolFilter)
                );
            }
            
            pool.innerHTML = filteredStaff.map(s => {
                const displayPositions = s.role === "Mesul M√ºd√ºr" ? "üëë T√ºm Pozisyonlar" : s.positions.join(', ');
                return `
                    <div class="pool-item" draggable="true" ondragstart="drag(event, ${s.id})" data-positions="${s.positions.join(',')}">
                        <div>${s.name}</div>
                        ${s.badges.length > 0 ? `<div style="font-size: 1.2rem; margin-bottom: 8px;">${s.badges.slice(0, 3).map(b => badgeDefinitions.find(bd => bd.id === b)?.emoji || '').join(' ')}</div>` : ''}
                        <div class="positions">${displayPositions}</div>
                    </div>
                `;
            }).join('');
        }

        function filterPool(position) {
            currentPoolFilter = position;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderStaffPool();
        }

        // Drag & Drop
        function drag(event, staffId) {
            event.dataTransfer.setData('staffId', staffId);
            event.dataTransfer.setData('type', 'new');
            event.target.classList.add('dragging');
        }

        function dragAssigned(event, day, shiftId, index) {
            event.dataTransfer.setData('day', day);
            event.dataTransfer.setData('shiftId', shiftId);
            event.dataTransfer.setData('index', index);
            event.dataTransfer.setData('type', 'move');
        }

        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function leaveDrop(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        
        
        function dropToPosition(event, day, shiftId, position) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            if (!schedule[day]) schedule[day] = {};
            if (!schedule[day][shiftId]) schedule[day][shiftId] = [];
            
            const staffId = parseInt(event.dataTransfer.getData('staffId'));
            const type = event.dataTransfer.getData('type');
            
            if (!staffId) return;
            
            const s = staff.find(x => x.id === staffId);
            if (!s) return;
            
            // ƒ∞zinli mi?
            const dayLeaves = leaves[day] || [];
            if (dayLeaves.some(l => l.staffId === staffId)) {
                showAlert(`${s.name} bu g√ºn izinli!`, 'error');
                return;
            }
            
            // Zaten var mƒ±?
            const existing = schedule[day][shiftId].find(a => a.staffId === staffId);
            
            if (existing) {
                // √áift pozisyon ekle
                if (!existing.positions) {
                    existing.positions = [existing.position];
                    delete existing.position;
                }
                
                if (!existing.positions.includes(position)) {
                    existing.positions.push(position);
                    saveToStorage();
                    updateBadges();
                    renderSchedule();
                    showAlert(`ƒ∞kinci pozisyon: ${position}`, 'success');
                } else {
                    showAlert('Bu pozisyon zaten atanmƒ±≈ü!', 'error');
                }
                return;
            }
            
            // Yeni atama
            if (s.role !== "Mesul M√ºd√ºr" && s.positions.length > 0 && !s.positions.includes(position)) {
                showAlert(`${s.name} ${position} pozisyonunda √ßalƒ±≈üamaz!`, 'error');
                return;
            }
            
            schedule[day][shiftId].push({
                staffId: staffId,
                position: position
            });
            
            saveToStorage();
            updateBadges();
            renderSchedule();
            updateDashboard();
            showAlert(`${s.name} ‚Üí ${position}`, 'success');
        }

        function dragFromPosition(event, day, shiftId, staffId, position) {
            event.dataTransfer.setData('staffId', staffId);
            event.dataTransfer.setData('day', day);
            event.dataTransfer.setData('shiftId', shiftId);
            event.dataTransfer.setData('position', position);
            event.dataTransfer.setData('type', 'move');
        }

        function removeFromPosition(day, shiftId, staffId, position) {
            if (!schedule[day] || !schedule[day][shiftId]) return;
            
            const assignment = schedule[day][shiftId].find(a => a.staffId === staffId);
            if (!assignment) return;
            
            if (assignment.positions && assignment.positions.length > 1) {
                // Sadece bu pozisyonu kaldƒ±r
                assignment.positions = assignment.positions.filter(p => p !== position);
                if (assignment.positions.length === 1) {
                    assignment.position = assignment.positions[0];
                    delete assignment.positions;
                }
            } else {
                // T√ºm atamayƒ± kaldƒ±r
                schedule[day][shiftId] = schedule[day][shiftId].filter(a => a.staffId !== staffId);
            }
            
            saveToStorage();
            updateBadges();
            renderSchedule();
            updateDashboard();
            showAlert('Atama kaldƒ±rƒ±ldƒ±', 'success');
        }


        function drop(event, day, shiftId) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            // G√ºvenlik kontrol√º
            if (!schedule[day]) schedule[day] = {};
            if (!schedule[day][shiftId]) schedule[day][shiftId] = [];
            
            const type = event.dataTransfer.getData('type');
            const staffId = parseInt(event.dataTransfer.getData('staffId'));
            
            if (!staffId) {
                showAlert('Personel bilgisi alƒ±namadƒ±', 'error');
                return;
            }
            
            const s = staff.find(x => x.id === staffId);
            if (!s) {
                showAlert('Personel bulunamadƒ±', 'error');
                return;
            }
            
            // ƒ∞zinli mi kontrol
            const dayLeaves = leaves[day] || [];
            if (dayLeaves.some(l => l.staffId === staffId)) {
                showAlert(`${s.name} bu g√ºn izinli! Vardiya atanamazsƒ±nƒ±z.`, 'error');
                return;
            }
            
            // Zaten bu vardiyada var mƒ±?
            const existing = schedule[day][shiftId].find(a => a.staffId === staffId);
            
            if (existing) {
                // √áƒ∞FT POZƒ∞SYON EKLE
                const newPosition = selectPosition(s);
                if (!newPosition) return;
                
                if (!existing.positions) {
                    existing.positions = [existing.position || newPosition];
                    delete existing.position;
                }
                
                if (!existing.positions.includes(newPosition)) {
                    existing.positions.push(newPosition);
                    saveToStorage();
                    updateBadges();
                    renderSchedule();
                    showAlert(`ƒ∞kinci pozisyon eklendi: ${newPosition} (Saat deƒüi≈ümedi - 8 saat)`, 'success');
                } else {
                    showAlert('Bu pozisyon zaten atanmƒ±≈ü!', 'error');
                }
                return;
            }
            
            // Yeni atama
            if (type === 'move') {
                const sourceDay = event.dataTransfer.getData('day');
                const sourceShiftId = event.dataTransfer.getData('shiftId');
                const sourceIndex = parseInt(event.dataTransfer.getData('index'));
                
                const assignment = schedule[sourceDay][sourceShiftId][sourceIndex];
                
                schedule[sourceDay][sourceShiftId].splice(sourceIndex, 1);
                schedule[day][shiftId].push(assignment);
                
                saveToStorage();
                updateBadges();
                renderSchedule();
                updateDashboard();
                showAlert('Vardiya ta≈üƒ±ndƒ±', 'success');
                return;
            }
            
            // Yeni personel atama
            const position = selectPosition(s);
            if (!position) return;
            
            if (s.role !== "Mesul M√ºd√ºr" && s.positions.length > 0 && !s.positions.includes(position)) {
                showAlert(`${s.name} ${position} pozisyonunda √ßalƒ±≈üamaz!`, 'error');
                return;
            }
            
            schedule[day][shiftId].push({ 
                staffId: staffId, 
                position: position 
            });
            
            saveToStorage();
            updateBadges();
            renderSchedule();
            updateDashboard();
            showAlert(`${s.name} vardiyaya atandƒ±`, 'success');
        }

        
        function selectPosition(staffMember) {
            // Mesul M√ºd√ºr can be assigned to any position
            if (staffMember.role === 'Mesul M√ºd√ºr') {
                const allPositions = ["Izgara", "Mutfak", "Ocak", "Kasiyer", "Garson", "Temizlik"];
                if (currentPoolFilter !== 'all' && allPositions.includes(currentPoolFilter)) {
                    return currentPoolFilter;
                }
                const options = allPositions.map((p, i) => `${i + 1}. ${positionEmojis[p]} ${p}`).join('\n');
                const choice = prompt(`Pozisyon se√ßin:\n${options}`);
                if (!choice) return null;
                const index = parseInt(choice) - 1;
                if (index >= 0 && index < allPositions.length) {
                    return allPositions[index];
                }
                return allPositions[0];
            }
            
            // If filter is active and staff has that position, use it
            if (currentPoolFilter !== 'all' && staffMember.positions.includes(currentPoolFilter)) {
                return currentPoolFilter;
            }
            
            if (staffMember.positions.length === 1) {
                return staffMember.positions[0];
            }
            
            const options = staffMember.positions.map((p, i) => `${i + 1}. ${positionEmojis[p]} ${p}`).join('\n');
            const choice = prompt(`Pozisyon se√ßin:\n${options}`);
            
            if (!choice) return null;
            
            const index = parseInt(choice) - 1;
            if (index >= 0 && index < staffMember.positions.length) {
                return staffMember.positions[index];
            }
            
            return staffMember.positions[0];
        }

        function hasConflict(staffId, day, shiftId, excludeDay = null, excludeShiftId = null) {
            const shiftTimes = {
                morning: { start: 8, end: 16 },
                afternoon: { start: 12, end: 20 },
                evening: { start: 16, end: 24 }
            };
            
            const newShift = shiftTimes[shiftId];
            
            for (const d of days) {
                for (const s of shifts) {
                    if (d === excludeDay && s.id === excludeShiftId) continue;
                    
                    const assignments = schedule[d][s.id];
                    const existing = assignments.find(a => a.staffId === staffId);
                    
                    if (existing && d === day) {
                        const existingShift = shiftTimes[s.id];
                        
                        // Check overlap
                        if (newShift.start < existingShift.end && newShift.end > existingShift.start) {
                            return true;
                        }
                    }
                }
            }
            
            return false;
        }

        function removeAssignment(day, shiftId, index) {
            schedule[day][shiftId].splice(index, 1);
            saveToStorage();
            renderSchedule();
        renderLeaveSummary();
            updateDashboard();
            initializeLeaves();
        updateBadges();
            showAlert('Atama kaldƒ±rƒ±ldƒ±', 'success');
        }

        // Schedule Actions
        function copyWeek() {
            if (!confirm('Bu haftayƒ± gelecek haftaya kopyalamak istiyor musunuz?')) return;
            showAlert('Bu √∂zellik yakƒ±nda eklenecek', 'error');
        }

        function clearWeek() {
            if (!confirm('Bu haftanƒ±n t√ºm vardiyalarƒ±nƒ± temizlemek istediƒüinizden emin misiniz?')) return;
            
            days.forEach(day => {
                shifts.forEach(shift => {
                    schedule[day][shift.id] = [];
                });
            });
            
            saveToStorage();
            renderSchedule();
        renderLeaveSummary();
            updateDashboard();
            showAlert('Hafta temizlendi', 'success');
        }

        function exportToWhatsApp() {
            let message = '';
            
            days.forEach(day => {
                const dayAssignments = [];
                shifts.forEach(shift => {
                    if (schedule[day][shift.id].length > 0) {
                        dayAssignments.push({ shift, assignments: schedule[day][shift.id] });
                    }
                });
                
                if (dayAssignments.length === 0) return;
                
                message += `üìÖ VARDƒ∞YA Lƒ∞STESƒ∞ - ${day}\n\n`;
                
                dayAssignments.forEach(({ shift, assignments }) => {
                    message += `${shift.time}\n`;
                    
                    const byPosition = {};
                    assignments.forEach(a => {
                        if (!byPosition[a.position]) byPosition[a.position] = [];
                        const s = staff.find(x => x.id === a.staffId);
                        if (s) byPosition[a.position].push(s.name);
                    });
                    
                    Object.entries(byPosition).forEach(([position, names]) => {
                        message += `${positionEmojis[position]} ${position}: ${names.join(', ')}\n`;
                    });
                    
                    message += '\n';
                });
                
                message += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';
            });
            
            if (!message) {
                showAlert('Hen√ºz vardiya atanmamƒ±≈ü!', 'error');
                return;
            }
            
            // Copy to clipboard
            navigator.clipboard.writeText(message).then(() => {
                showToast('‚úÖ Kopyalandƒ±! WhatsApp\'a yapƒ±≈ütƒ±rabilirsiniz');
            }).catch(() => {
                showAlert('Kopyalama ba≈üarƒ±sƒ±z', 'error');
            });
        }

        // Alert & Toast
        function showAlert(message, type = 'error') {
            const alert = document.getElementById('alert');
            const icon = document.getElementById('alert-icon');
            const msg = document.getElementById('alert-message');
            
            alert.className = 'alert ' + type;
            icon.textContent = type === 'error' ? '‚ö†Ô∏è' : '‚úÖ';
            msg.textContent = message;
            
            alert.classList.add('show');
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toast-message');
            
            msg.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }


        // PERFORMANCE MODULE
        function openPerformanceModal() {
            currentRatings = { speed: 0, hygiene: 0, quality: 0, teamwork: 0, stress: 0 };
            
            const staffSelect = document.getElementById('perf-staff');
            staffSelect.innerHTML = staff.map(s => 
                `<option value="${s.id}">${s.name}</option>`
            ).join('');
            
            updatePerformancePositions();
            resetStars();
            document.getElementById('perf-notes').value = '';
            document.getElementById('performance-modal').classList.add('show');
        }

        function closePerformanceModal() {
            document.getElementById('performance-modal').classList.remove('show');
        }

        function updatePerformancePositions() {
            const staffId = parseInt(document.getElementById('perf-staff').value);
            const s = staff.find(x => x.id === staffId);
            if (!s) return;
            
            const posSelect = document.getElementById('perf-position');
            if (s.role === "Mesul M√ºd√ºr") {
                const allPositions = ["Izgara", "Mutfak", "Ocak", "Kasiyer", "Garson", "Temizlik"];
                posSelect.innerHTML = allPositions.map(p => 
                    `<option value="${p}">${positionEmojis[p]} ${p}</option>`
                ).join('');
            } else {
                posSelect.innerHTML = s.positions.map(p => 
                    `<option value="${p}">${positionEmojis[p]} ${p}</option>`
                ).join('');
            }
        }

        function setRating(event, rating) {
            const container = event.target.closest('.stars');
            const criteria = container.dataset.criteria;
            currentRatings[criteria] = rating;
            
            const stars = container.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                }
            });
        }

        function resetStars() {
            document.querySelectorAll('.stars').forEach(container => {
                container.querySelectorAll('.star').forEach(star => {
                    star.classList.remove('filled');
                });
            });
        }

        function savePerformance(event) {
            event.preventDefault();
            
            const staffId = parseInt(document.getElementById('perf-staff').value);
            const position = document.getElementById('perf-position').value;
            const notes = document.getElementById('perf-notes').value;
            
            if (Object.values(currentRatings).some(r => r === 0)) {
                showAlert('L√ºtfen t√ºm kriterleri deƒüerlendirin', 'error');
                return;
            }
            
            const performance = {
                id: performances.length + 1,
                staffId,
                position,
                date: new Date().toISOString(),
                ratings: { ...currentRatings },
                notes
            };
            
            performances.push(performance);
            saveToStorage();
            closePerformanceModal();
            renderPerformancePage();
            showAlert('Performans deƒüerlendirmesi kaydedildi', 'success');
        }

        function renderPerformancePage() {
            renderPerformanceReviews();
            renderPerformanceSummary();
        }

        function renderPerformanceReviews() {
            const container = document.getElementById('review-list');
            
            if (performances.length === 0) {
                container.innerHTML = '<div class="empty-list">Hen√ºz deƒüerlendirme yapƒ±lmamƒ±≈ü</div>';
                return;
            }
            
            const sorted = [...performances].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            ).slice(0, 10);
            
            container.innerHTML = sorted.map(perf => {
                const s = staff.find(x => x.id === perf.staffId);
                if (!s) return '';
                
                const avg = Object.values(perf.ratings).reduce((a, b) => a + b, 0) / 5;
                const date = new Date(perf.date).toLocaleDateString('tr-TR');
                
                return `
                    <div class="review-item">
                        <div class="review-header">
                            <div>
                                <strong>${s.name}</strong> - ${positionEmojis[perf.position]} ${perf.position}
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="color: #ffd700;">‚≠ê ${avg.toFixed(1)}/5</span>
                                <span class="review-date">${date}</span>
                            </div>
                        </div>
                        <div class="review-criteria">
                            <div class="criteria-item">
                                <span>Hƒ±z:</span>
                                <span>${'‚≠ê'.repeat(perf.ratings.speed)}</span>
                            </div>
                            <div class="criteria-item">
                                <span>Hijyen:</span>
                                <span>${'‚≠ê'.repeat(perf.ratings.hygiene)}</span>
                            </div>
                            <div class="criteria-item">
                                <span>Kalite:</span>
                                <span>${'‚≠ê'.repeat(perf.ratings.quality)}</span>
                            </div>
                            <div class="criteria-item">
                                <span>Takƒ±m:</span>
                                <span>${'‚≠ê'.repeat(perf.ratings.teamwork)}</span>
                            </div>
                            <div class="criteria-item">
                                <span>Stres:</span>
                                <span>${'‚≠ê'.repeat(perf.ratings.stress)}</span>
                            </div>
                        </div>
                        ${perf.notes ? `<div style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary); font-style: italic;">"${perf.notes}"</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderPerformanceSummary() {
            const avgContainer = document.getElementById('avg-performance-summary');
            const topContainer = document.getElementById('top-performance');
            
            if (performances.length === 0) {
                avgContainer.innerHTML = '<div class="empty-list">Hen√ºz deƒüerlendirme yok</div>';
                topContainer.innerHTML = '<div class="empty-list">Hen√ºz deƒüerlendirme yok</div>';
                return;
            }
            
            const staffPerf = {};
            staff.forEach(s => {
                const perfs = performances.filter(p => p.staffId === s.id);
                if (perfs.length > 0) {
                    const total = perfs.reduce((sum, p) => {
                        return sum + Object.values(p.ratings).reduce((a, b) => a + b, 0) / 5;
                    }, 0);
                    staffPerf[s.id] = total / perfs.length;
                }
            });
            
            const overallAvg = Object.values(staffPerf).reduce((a, b) => a + b, 0) / Object.keys(staffPerf).length;
            
            avgContainer.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 2.5rem; color: #ffd700; margin-bottom: 8px;">‚≠ê ${overallAvg.toFixed(2)}/5</div>
                    <div style="color: var(--text-secondary);">Genel Ortalama Performans</div>
                    <div style="margin-top: 12px; font-size: 0.9rem;">
                        ${Object.keys(staffPerf).length} personel deƒüerlendirildi
                    </div>
                </div>
            `;
            
            const sorted = Object.entries(staffPerf)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);
            
            topContainer.innerHTML = sorted.map(([id, avg]) => {
                const s = staff.find(x => x.id === parseInt(id));
                return `
                    <div style="padding: 12px; background: var(--bg-tertiary); border-radius: 10px; margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong>${s.name}</strong>
                            <span style="color: #ffd700; font-size: 1.1rem;">‚≠ê ${avg.toFixed(2)}/5</span>
                        </div>
                        <div style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                            ${s.totalHours} saat √ßalƒ±≈ütƒ±
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getAveragePerformance(staffId) {
            const perfs = performances.filter(p => p.staffId === staffId);
            if (perfs.length === 0) return null;
            
            const total = perfs.reduce((sum, p) => {
                return sum + Object.values(p.ratings).reduce((a, b) => a + b, 0) / 5;
            }, 0);
            
            return total / perfs.length;
        }


        // GAMIFICATION MODULE
        function updateTotalHours() {
            staff.forEach(s => {
                let hours = 0;
                days.forEach(day => {
                    shifts.forEach(shift => {
                        const assigned = schedule[day][shift.id].find(a => a.staffId === s.id);
                        if (assigned) hours += 8;
                    });
                });
                s.totalHours = hours;
            });
        }

        function updateBadges() {
            updateTotalHours();
            
            staff.forEach(s => {
                const earned = [];
                
                // Hours badges
                if (s.totalHours >= 500) earned.push('master');
                else if (s.totalHours >= 300) earned.push('expert');
                else if (s.totalHours >= 150) earned.push('experienced');
                else if (s.totalHours >= 50) earned.push('novice');
                
                // Position hours
                const posHours = {};
                days.forEach(day => {
                    shifts.forEach(shift => {
                        schedule[day][shift.id].forEach(a => {
                            if (a.staffId === s.id) {
                                posHours[a.position] = (posHours[a.position] || 0) + 8;
                            }
                        });
                    });
                });
                
                if (posHours['Izgara'] >= 100) earned.push('izgara-master');
                if (posHours['Garson'] >= 200) earned.push('super-waiter');
                if (posHours['Mutfak'] >= 150) earned.push('chef-candidate');
                
                // Shift count for cashier
                let cashierShifts = 0;
                days.forEach(day => {
                    shifts.forEach(shift => {
                        if (schedule[day][shift.id].some(a => a.staffId === s.id && a.position === 'Kasiyer')) {
                            cashierShifts++;
                        }
                    });
                });
                if (cashierShifts >= 50) earned.push('quick-cashier');
                
                // Performance badge
                const avg = getAveragePerformance(s.id);
                if (avg && avg >= 4.8) earned.push('star-performer');
                
                // Versatile (worked in 4+ positions)
                if (Object.keys(posHours).length >= 4) earned.push('versatile');
                
                s.badges = earned;
            });
            
            saveToStorage();
        }

        function renderGamificationPage() {
            initializeLeaves();
        updateBadges();
            renderLeaderboard();
            renderAllBadges();
        }

        function showLeaderboard(type) {
            currentLeaderboardType = type;
            document.querySelectorAll('.leaderboard-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            renderLeaderboard();
        }

        function renderLeaderboard() {
            const container = document.getElementById('leaderboard-list');
            let sorted = [];
            
            if (currentLeaderboardType === 'weekly') {
                const staffShifts = {};
                staff.forEach(s => staffShifts[s.id] = 0);
                
                days.forEach(day => {
                    shifts.forEach(shift => {
                        schedule[day][shift.id].forEach(a => {
                            staffShifts[a.staffId]++;
                        });
                    });
                });
                
                sorted = staff.map(s => ({
                    staff: s,
                    value: staffShifts[s.id],
                    label: `${staffShifts[s.id]} vardiya`
                })).filter(x => x.value > 0).sort((a, b) => b.value - a.value);
                
            } else if (currentLeaderboardType === 'alltime') {
                sorted = staff.map(s => ({
                    staff: s,
                    value: s.totalHours,
                    label: `${s.totalHours} saat`
                })).filter(x => x.value > 0).sort((a, b) => b.value - a.value);
                
            } else if (currentLeaderboardType === 'performance') {
                sorted = staff.map(s => {
                    const avg = getAveragePerformance(s.id);
                    return {
                        staff: s,
                        value: avg || 0,
                        label: avg ? `‚≠ê ${avg.toFixed(2)}/5` : 'Deƒüerlendirilmedi'
                    };
                }).filter(x => x.value > 0).sort((a, b) => b.value - a.value);
            }
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="empty-list">Hen√ºz veri yok</div>';
                return;
            }
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const classes = ['gold', 'silver', 'bronze'];
            
            container.innerHTML = sorted.map((item, index) => {
                const badgeIcons = item.staff.badges.slice(0, 5).map(b => 
                    badgeDefinitions.find(bd => bd.id === b)?.emoji || ''
                ).join(' ');
                
                return `
                    <div class="leaderboard-item ${index < 3 ? classes[index] : ''}">
                        <div class="leaderboard-rank">${index < 3 ? medals[index] : (index + 1)}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${item.staff.name}</div>
                            <div class="leaderboard-stats">${item.label}</div>
                        </div>
                        ${badgeIcons ? `<div class="leaderboard-badges">${badgeIcons}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderAllBadges() {
            const container = document.getElementById('all-badges');
            
            const allEarned = new Set();
            staff.forEach(s => {
                s.badges.forEach(b => allEarned.add(b));
            });
            
            container.innerHTML = badgeDefinitions.map(badge => {
                const earned = allEarned.has(badge.id);
                const earners = staff.filter(s => s.badges.includes(badge.id));
                
                return `
                    <div class="badge-item ${earned ? 'earned' : 'locked'}" title="${earners.map(s => s.name).join(', ') || 'Hen√ºz kimse kazanmadƒ±'}">
                        <div class="badge-icon">${badge.emoji}</div>
                        <div class="badge-name">${badge.name}</div>
                        <div class="badge-desc">${badge.desc}</div>
                        ${earned ? `<div style="font-size: 0.7rem; color: var(--success); margin-top: 4px;">${earners.length} ki≈üi</div>` : ''}
                    </div>
                `;
            }).join('');
        }



        // √ñZEL G√úNLER
        function openSpecialDayModal(day) {
            if (day) {
                document.getElementById('special-day-select').value = day;
            }
            document.getElementById('special-day-modal').classList.add('show');
        }

        function closeSpecialDayModal() {
            document.getElementById('special-day-modal').classList.remove('show');
        }

        function saveSpecialDay(event) {
            event.preventDefault();
            
            const day = document.getElementById('special-day-select').value;
            const type = document.getElementById('special-day-type').value;
            const name = document.getElementById('special-day-name').value;
            
            specialDays[day] = { type, name };
            
            saveToStorage();
            closeSpecialDayModal();
            renderSchedule();
            showAlert(`√ñzel g√ºn eklendi: ${name}`, 'success');
        }

        function removeSpecialDay(day) {
            if (!confirm(`${day} i√ßin √∂zel g√ºn√º kaldƒ±rmak istediƒüinizden emin misiniz?`)) return;
            
            delete specialDays[day];
            saveToStorage();
            renderSchedule();
            showAlert('√ñzel g√ºn kaldƒ±rƒ±ldƒ±', 'success');
        }

        // LEAVE MANAGEMENT
        function initializeLeaves() {
            days.forEach(day => {
                if (!leaves[day]) leaves[day] = [];
            });
        }

        function openLeaveModal() {
            const staffSelect = document.getElementById('leave-staff');
            staffSelect.innerHTML = staff.map(s => 
                `<option value="${s.id}">${s.name}</option>`
            ).join('');
            document.getElementById('leave-modal').classList.add('show');
        }

        function closeLeaveModal() {
            document.getElementById('leave-modal').classList.remove('show');
        }

        function saveLeave(event) {
            event.preventDefault();
            
            const staffId = parseInt(document.getElementById('leave-staff').value);
            const day = document.getElementById('leave-day').value;
            const type = document.getElementById('leave-type').value;
            
            if (!leaves[day]) leaves[day] = [];
            
            // Zaten izinli mi kontrol et
            if (leaves[day].some(l => l.staffId === staffId)) {
                showAlert('Bu personel zaten bu g√ºn izinli!', 'error');
                return;
            }
            
            leaves[day].push({ staffId, type });
            saveToStorage();
            closeLeaveModal();
            renderLeaveSummary();
            showAlert('ƒ∞zin eklendi', 'success');
        }

        function removeLeave(day, staffId) {
            if (!confirm('ƒ∞zni kaldƒ±rmak istediƒüinizden emin misiniz?')) return;
            
            leaves[day] = leaves[day].filter(l => l.staffId !== staffId);
            saveToStorage();
            renderLeaveSummary();
            showAlert('ƒ∞zin kaldƒ±rƒ±ldƒ±', 'success');
        }

        function renderLeaveSummary() {
            const container = document.getElementById('leave-summary');
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">';
            
            days.forEach(day => {
                const dayLeaves = leaves[day] || [];
                
                html += `
                    <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 10px; border: 1px solid var(--border);">
                        <div style="font-weight: 600; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                            <span>${day}</span>
                            <span style="font-size: 0.85rem; color: var(--text-secondary);">${dayLeaves.length} ki≈üi</span>
                        </div>
                        ${dayLeaves.length > 0 ? `
                            <div style="display: flex; flex-direction: column; gap: 6px;">
                                ${dayLeaves.map(leave => {
                                    const s = staff.find(x => x.id === leave.staffId);
                                    return `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; background: rgba(255, 146, 43, 0.1); border-radius: 6px; font-size: 0.85rem;">
                                            <span>
                                                ${s.name}
                                                <span style="color: var(--text-secondary); font-size: 0.75rem; margin-left: 4px;">(${leave.type})</span>
                                            </span>
                                            <button onclick="removeLeave('${day}', ${leave.staffId})" style="background: none; border: none; color: var(--accent); cursor: pointer; font-size: 1rem;">√ó</button>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : '<div style="color: var(--text-secondary); font-size: 0.85rem; font-style: italic;">ƒ∞zinli personel yok</div>'}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Close modal on overlay click
        document.getElementById('staff-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeStaffModal();
            }
        });

        document.getElementById('performance-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closePerformanceModal();
            }
        });

        document.getElementById('leave-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeLeaveModal();
            }
        });
    </script>
</body>
</html>
